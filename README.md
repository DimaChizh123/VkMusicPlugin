# VkMusicPlugin

**Плагин** для **VS Code**, который выводит название песни, которая на данный момент играет у вас в **VK Music**

## Использование

1. Включите трансляцию музыки в ваш статус  
![Кнопка трансляции музыки](MusicTranslationIcon.png)

2. Получите [токен](https://dev.vk.com/ru/api/access-token/getting-started#Ключ%20доступа%20пользователя)

3. Склонируйте репозиторий в любую удобную вам папку
    ```bash
    git clone https://github.com/DimaChizh123/VkMusicPlugin.git
    ```

4. Если у вас не установлен vsce, выполните команду
    ```bash
    npm install -g @vscode/vsce
    ```

5. В корневой папке проекта выполните команду
    ```bash
    vsce package
    ```

6. Перейдите в раздел Extensions в VS Code -> Нажмите на "..." -> Install from VSIX... -> Выберите созданный в прошлом пункте файл

7. При первом запуске, введите токен в окно ввода
![Окно ввода токена](TokenInputWindow.png)

8. При необходимости окно ввода токена можно вызвать повторно, вызвав Command Palette (Ctrl+Shift+P) и введя команду Set Token

9. Готово! Теперь та музыка, которую вы в данный момент слушаете в VK Music отображается в статус баре

## Функционал

* activate(context: vscode.ExtensionContext) - функция, вызывающаяся при запуске VS Code.  Она создаёт StatusBarItem, получает token из secrets, запускает цикл получения названия трека (если токен найден в secrets) или вызывает окно ввода токена (иначе), а также добавляет команду Set Token для самостоятельного вызова окна ввода токена.  
Параметры:  
context: vscode.ExtensionContext - коллекция приватных утилит расширения, включая secrets и subscriptions
    ```
    activate(context: vscode.ExtensionContext) -> undefined
    ```

* SetToken(context: vscode.ExtensionContext) - функция, получающая токен из окна ввода.
Она создаёт окно ввода токена, получает из него сам токен, запускает цикл получения названия трека и сохраняет токен в secrets.  
Параметры:  
context: vscode.ExtensionContext - коллекция приватных утилит расширения, включая secrets
    ```
    SetToken(context: vscode.ExtensionContext) -> undefined
    ```

* StartLoop(token: string) - функция, запускающая цикл получения трека.
Она очищает существующий объект интервала (защита от запуска нескольких циклов одновременно), устанавливает интервал с функцией, получающей название трека и вызывает функцию SetTrack.  
Параметры:  
token: string - токен, используемый для взаимодействия с VK API
    ```
    StartLoop(token: string) -> undefined
    ```

* GetMusic(token: string) - функция, получающая название трека из VK API. Она делает запрос к VK API и получает статус пользователя. Если в статус транслируется аудио, она возвращает название трека. Если аудио не транслируется, она возвращает путую строку. Если что-то не так, она возвращает текст ошибки.  
Параметры:  
token: string - токен, используемый для взаимодействия с VK API  
Возвращаемое значение:  
string - название трека / пустая строка / сообщение ошибки
    ```
    GetMusic(token: string) -> string
    ```

* SetTrack(track: string) - функция, устанавливающая название трека в status bar. Она проверяет совпадение текущего значение статус бара и передаваемого и при несовпадении: если передана пустая строка (музыка не транслируется в статус) - скрывает StatusBarItem, иначе - меняет текст в StatusBarItem.  
Параметры:  
track: string - название трека / пустая строка / сообщение ошибки  
    ```
    SetTrack(track: string) -> undefined
    ```

* deactivate() - функция, вызывающаяся при завершении работы расширения. Она утилизирует StatusBarItem и очищает объект интервала
    ```
    deactivate() -> undefined
    ```

## История проекта

### Коммит c344542 - Добавлено скрытие StatusBarItem при отсутствии трансляции трека в статус

### Коммит 5ad5bf9 - Исправлена опечатка в документации

### Коммит 6b9b085 - Проект готов к сборке

### Коммит e6c0106 - Реализован основной функционал. Добавлена документация